<!--
`px-button` is is a standard Power Xpert styled button that performs an action.

Example:

    <px-button positive icon="px-icons:lock">Edit</px-button>

@group Desktop
@element px-button
@hero hero.svg
@demo demo/index.html
-->

<link href="../polymer/polymer.html" rel="import">

<link href="../iron-icon/iron-icon.html" rel="import">
<link href="../iron-media-query/iron-media-query.html" rel="import">
<link href="../iron-flex-layout/iron-flex-layout.html" rel="import">


<dom-module id="px-button">
    <style>
        /* Style for the buttons */
                :host {
                    /*display: inline-block;*/
                    display: block;
                    position: relative;
                    box-sizing: border-box;

                    padding: 0;

                    /* make ems */
                    min-width: 150px;
                    width:150px;
                    height: 35px;

                    text-align: center;
                    font-family: "Open Sans", sans-serif;
                    font-size: 14px;
                    font-weight: 600;
                    text-overflow: "…" "…";

                    outline: none;
                    border-radius: 0px;
                    -webkit-user-select: none;
                    -moz-user-select: none;
                    -ms-user-select: none;
                    user-select: none;
                    cursor: pointer;
                    z-index: 0;

                    color:#606060;

                    background: #ffffff;
                    background: -moz-linear-gradient(top, #ffffff 0%, #f2f2f2 100%);
                    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#ffffff), color-stop(100%,#f2f2f2));
                    background: -webkit-linear-gradient(top, #ffffff 0%,#f2f2f2 100%);
                    background: -o-linear-gradient(top, #ffffff 0%,#f2f2f2 100%);
                    background: -ms-linear-gradient(top, #ffffff 0%,#f2f2f2 100%);
                    background: linear-gradient(to bottom, #ffffff 0%,#f2f2f2 100%);
                    filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#ffffff', endColorstr='#f2f2f2',GradientType=0 );

                    box-shadow: 0 1px 0 rgba(0,0,0,0.05), 0 1px 0 rgba(255,255,255,.1) inset;
                    border:1px solid #c1c1c1;
                }
                :host([forcesmall]),
                :host([small]),
                :host-context([small]) {
                    min-width: 40px;
                    width:40px;
                }  
                :host([fixedwidth]){
                    width:150px;
                    min-width:150px;
                }
                :host([sidebar]) {
                    width:325px;
                }
                :host([flex]){
                    -webkit-flex: 1;-ms-flex: 1;flex: 1;
                    min-width: 0;
                }
                :host([dark]), :host-context([dark]) {
                    background: #545454;
                    background: -moz-linear-gradient(top,  #545454 0%, #333333 100%);
                    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#545454), color-stop(100%,#333333));
                    background: -webkit-linear-gradient(top,  #545454 0%,#333333 100%);
                    background: -o-linear-gradient(top,  #545454 0%,#333333 100%);
                    background: -ms-linear-gradient(top,  #545454 0%,#333333 100%);
                    background: linear-gradient(to bottom,  #545454 0%,#333333 100%);
                    filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#545454', endColorstr='#333333',GradientType=0 );

                    border-color:#161616;
                    color: #f3f3f3;
                }
                :host([primary]) {
                    border: 1px solid #0e6eb8;
                }
                :host([chameleon]) {
                    background: -moz-linear-gradient(top,  rgba(0,0,0,0.05) 0%, rgba(0,0,0,0.125) 100%);
                    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(0,0,0,0.05)), color-stop(100%,rgba(0,0,0,0.125)));
                    background: -webkit-linear-gradient(top,  rgba(0,0,0,0.05) 0%,rgba(0,0,0,0.125) 100%);
                    background: -o-linear-gradient(top,  rgba(0,0,0,0.05) 0%,rgba(0,0,0,0.125) 100%);
                    background: -ms-linear-gradient(top,  rgba(0,0,0,0.05) 0%,rgba(0,0,0,0.125) 100%);
                    background: linear-gradient(to bottom,  rgba(0,0,0,0.05) 0%,rgba(0,0,0,0.125) 100%);
                    filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#1a000000', endColorstr='#4d000000',GradientType=0 );

                    border-color:rgba(0,0,0,.2);
                    color: rgba(0,0,0,.5);
                }
                :host([positive]) {
                    background: #0d87c2; 
                    background: -moz-linear-gradient(top,  #0d87c2 0%, #005fa2 100%);
                    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#0d87c2), color-stop(100%,#005fa2));
                    background: -webkit-linear-gradient(top,  #0d87c2 0%,#005fa2 100%); 
                    background: -o-linear-gradient(top,  #0d87c2 0%,#005fa2 100%); 
                    background: -ms-linear-gradient(top,  #0d87c2 0%,#005fa2 100%); 
                    background: linear-gradient(to bottom,  #0d87c2 0%,#005fa2 100%); 
                    filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#0d87c2', endColorstr='#005fa2',GradientType=0 );

                    border-color:#0e6eb8;
                    color: #f3f3f3;
                }
                :host([negative]) {
                    background: #f33333; 
                    background: -moz-linear-gradient(top,  #f33333 0%, #c50404 100%); 
                    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#f33333), color-stop(100%,#c50404)); 
                    background: -webkit-linear-gradient(top,  #f33333 0%,#c50404 100%); 
                    background: -o-linear-gradient(top,  #f33333 0%,#c50404 100%); 
                    background: -ms-linear-gradient(top,  #f33333 0%,#c50404 100%); 
                    background: linear-gradient(to bottom,  #f33333 0%,#c50404 100%); 
                    filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#f33333', endColorstr='#c50404',GradientType=0 );

                    border-color:#c50404;
                    color: #f3f3f3;
                }
                :host([disabled]) {
                    opacity: .35;
                    cursor: auto;
                    pointer-events: none;
                }

        /* Styles for button hover */
            /* Normal */
                :host(:hover) {
                    background: #ffffff;
                    background: -moz-linear-gradient(top, #ffffff 0%, #f7f7f7 100%);
                    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#ffffff), color-stop(100%,#f7f7f7));
                    background: -webkit-linear-gradient(top, #ffffff 0%,#f7f7f7 100%);
                    background: -o-linear-gradient(top, #ffffff 0%,#f7f7f7 100%);
                    background: -ms-linear-gradient(top, #ffffff 0%,#f7f7f7 100%); 
                    background: linear-gradient(to bottom, #ffffff 0%,#f7f7f7 100%);
                    filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#ffffff', endColorstr='#f7f7f7',GradientType=0 ); 

                    /*color: #606060;*/
                    color: #0e6eb8;
                }

            /* Colored */
                :host-context([dark]):hover, :host(:hover[dark]){
                    background: #5c5c5c;
                    background: -moz-linear-gradient(top,  #5c5c5c 0%, #3b3b3b 100%);
                    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#5c5c5c), color-stop(100%,#3b3b3b));
                    background: -webkit-linear-gradient(top,  #5c5c5c 0%,#3b3b3b 100%);
                    background: -o-linear-gradient(top,  #5c5c5c 0%,#3b3b3b 100%);
                    background: -ms-linear-gradient(top,  #5c5c5c 0%,#3b3b3b 100%); 
                    background: linear-gradient(to bottom,  #5c5c5c 0%,#3b3b3b 100%);
                    filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#5c5c5c', endColorstr='#3b3b3b',GradientType=0 ); 

                    color: #f3f3f3;
                }
                :host(:hover[positive]){
                    background: #158fca;
                    background: -moz-linear-gradient(top,  #158fca 0%, #0867aa 100%);
                    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#158fca), color-stop(100%,#0867aa));
                    background: -webkit-linear-gradient(top,  #158fca 0%,#0867aa 100%);
                    background: -o-linear-gradient(top,  #158fca 0%,#0867aa 100%);
                    background: -ms-linear-gradient(top,  #158fca 0%,#0867aa 100%); 
                    background: linear-gradient(to bottom,  #158fca 0%,#0867aa 100%);
                    filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#158fca', endColorstr='#0867aa',GradientType=0 ); 

                    color: #f3f3f3;
                }
                :host(:hover[negative]){
                    background: #fb3b3b;
                    background: -moz-linear-gradient(top,  #fb3b3b 0%, #cd0c0c 100%);
                    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#fb3b3b), color-stop(100%,#cd0c0c));
                    background: -webkit-linear-gradient(top,  #fb3b3b 0%,#cd0c0c 100%);
                    background: -o-linear-gradient(top,  #fb3b3b 0%,#cd0c0c 100%);
                    background: -ms-linear-gradient(top,  #fb3b3b 0%,#cd0c0c 100%); 
                    background: linear-gradient(to bottom,  #fb3b3b 0%,#cd0c0c 100%);
                    filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#fb3b3b', endColorstr='#cd0c0c',GradientType=0 ); 

                    color: #f3f3f3;
                }

            /* Chameleon */
                :host(:hover[chameleon]){
                    background: -moz-linear-gradient(top,  rgba(33,33,33,0.05) 0%, rgba(33,33,33,0.125) 100%);
                    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(33,33,33,0.05)), color-stop(100%,rgba(33,33,33,0.125)));
                    background: -webkit-linear-gradient(top,  rgba(33,33,33,0.05) 0%,rgba(33,33,33,0.125) 100%);
                    background: -o-linear-gradient(top,  rgba(33,33,33,0.05) 0%,rgba(33,33,33,0.125) 100%);
                    background: -ms-linear-gradient(top,  rgba(33,33,33,0.05) 0%,rgba(33,33,33,0.125) 100%); 
                    background: linear-gradient(to bottom,  rgba(33,33,33,0.05) 0%,rgba(33,33,33,0.125) 100%);
                    filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#1a333333', endColorstr='#4d333333',GradientType=0 ); 

                    color: rgba(0,0,0,.5);
                } 

        /* Styles for pressed buttons */   
            /* Normal */
                :host(:active), :host([active]), :host([pressed]){
                    color: #0e6eb8;
                    box-shadow: 0 2px 6px rgba(0,0,0,0.125) inset;
                    background: #e6e6e6;
                }
            /* Dark */
                :host(:active[dark]), :host([active][dark]), :host([pressed][dark]),
                :host-context([dark]):active, :host-context([dark])[active], :host-context([dark])[pressed]{
                    background: #1f1f1f;
                    color: #f3f3f3;
                }
            /* Positive */
                :host(:active[positive]), :host([active][positive]), :host([pressed][positive]){
                    background: #095087;
                    color: #f3f3f3;
                }
            /* Negative */
                :host(:active[negative]), :host([active][negative]), :host([pressed][negative]){
                    background: #b80909;
                    color: #f3f3f3;
                }
            /* Chameleon */
                :host(:active[chameleon]), :host([active][chameleon]), :host([pressed][chameleon]){
                    background: rgba(0,0,0,0.25);
                    color: rgba(0,0,0,.5);
                }

        /* Add a glow to active state (tab navigation) */
            :host(:focus), :host([active]), :host(:active){
                /*border: 2px solid #0e6eb8;*/
                border: 1px solid #0e6eb8;
                box-shadow: inset 0px 0px 10px rgba(2, 111, 190, .125), 0px 0px 25px rgba(2, 111, 190, .25);
                z-index: 2;
            }

        /* Style the internals */
            :host #focusWrapper{
                height: 100%;
                width: 100%;
                padding: 0 5px;
                box-sizing: border-box;
                border: 1px solid transparent;
            }
            :host(:focus) #focusWrapper, :host([active]) #focusWrapper, :host(.active) #focusWrapper, :host([primary]) #focusWrapper{
                border-color: #0e6eb8;
            }
            :host #button-content {
                height: 100%;
                width: 100%;
                @apply(--layout-horizontal);
                @apply(--layout-center-center);
            }
            :host #tool {
                height: 100%;
                width: 100%;
            }
            :host iron-icon {
                margin-right:5px;
                max-width: 20px;
                max-height: 20px;
                width: 20px;
                height: 20px;
            }
            :host #label{
                max-width: calc(100% - 25px);
                white-space:nowrap;
                text-overflow:ellipsis;
                overflow: hidden;
            }
            :host([small]:not([fixedwidth])) #label, :host([forcesmall]:not([fixedwidth])) #label,
            :host-context([small]) #label {
                display:none;
            };
            :host([small]:not([fixedwidth])) iron-icon, :host([forcesmall]:not([fixedwidth])) iron-icon,
            :host-context([small]) iron-icon {
                margin:0!important;
            }
    </style>

    <template>

        <div id="focusWrapper">
            <div id="button-content">
                <template is="dom-if" if="{{icon}}">
                    <iron-icon id="icon" icon="{{icon}}"></iron-icon>
                </template>
                <span id="label"><content></content></span>
            </div>
        </div>

        <iron-media-query
        query="{{mq}}"
        query-matches="{{forcesmall}}">
        </iron-media-query>
    </template>

    <script>
        Polymer({
            is: "px-button",
            listeners:{
                up: 'clearFocus',
                keydown: 'onKeydown',
                keypress: 'onKeypress',
                keyup: 'onKeyup'
            },
            clearFocus: function(event, detail, sender){
                this.blur();
            },
            hostAttributes:{
                role: "button",
                tabindex: 0
            },
            properties:{
                /**
                 *Media query that determines when the button will change to its small styling.
                 */
                mq: {type: String, value: "(max-width: 400px)"},

                /**
                 *The icon that will be displayed on the button.
                 */
                icon: {type: String, value: null},

                /**
                 *If set, the button will have a blue border, signaling that it is the primary action among a group of actions.
                 */
                primary: {type:Boolean, value: false},

                /**
                 *If set, the button will have a blue background. Typically used for actions such as Edit.
                 */
                positive: {type:Boolean, value: false},

                /**
                 *If set, the button will have a red background. Typically used for actions such as remove/delete.
                 */
                negative: {type:Boolean, value: false},

                /**
                 *If set, the button will take on darker styling, to be used in dark-colored containers.
                 */
                dark: {type:Boolean, value: false},

                /**
                 *If set, the button will take on a semi-transparent styling, to be used in containers of any color.
                 */
                chameleon: {type:Boolean, value:false},

                /**
                 *If set, the button will have a pressed appearance. Identical to `active`.
                 */
                pressed: {type:Boolean, value: false, reflectToAttribute: true},

                /**
                 *If set, the button will have a pressed appearance. Identical to `pressed`.
                 */
                active: {type:Boolean, value: false},
                
                /**
                 *If set, the button will appear square rather than rectangle. Labels will be hidden and only the icon will be displayed.
                 */
                small: {
                    type:Boolean,
                    value: false,
                    reflectToAttribute: true
                },

                /**
                 *Used in conjuction with `mq` to give the button the same appearance as `small`, but only when certain conditions are met. This value is set automatically based on `mq`.
                 */
                forcesmall: {
                    type:Boolean,
                    value: false,
                    reflectToAttribute: true
                },

                /**
                 *If set, the button will not grow or shrink from its default size (150px by 35px).
                 */
                fixedwidth: {type:Boolean, value: false},

                /**
                 *If set, the button will be wider than the standard button to fit in a px-sidebar (325px by 35px).
                 */
                sidebar: {type:Boolean, value: false},
                
                /**
                 *If set, the button width will grow or shrink to fill its parent container.
                 */
                flex:{type: Boolean, value: false},

                /**
                 *If set, the component will be grayed out and won't accept any user input.
                 */
                disabled:{type: Boolean, value: false}
            },

            onKeydown: function(e) {
                if ((e.keyCode === 32 || e.key === "Spacebar" || e.code === 'Space') && !this.disabled && !this.wasPressed) {
                    this.wasPressed = true;
                    this.oldPressed = this.pressed;
                    this.set('pressed', true);
                }
            },

            onKeypress: function(e) {
                if ((e.keyCode === 13 || e.key === 'Enter' || e.code === 'Enter') && !this.disabled) {
                    if (!this.wasPressed) {
                        this.wasPressed = true;
                        this.oldPressed = this.pressed;                        
                    }
                    this.fire('click');
                    this.set('pressed', !this.pressed || this.oldPressed);
                }
            },

            onKeyup: function(e) {
                if ((e.keyCode === 32 || e.key === "Spacebar" || e.code === 'Space') && !this.disabled && this.wasPressed) {
                    this.fire('click');
                }
                if (this.wasPressed) {
                    this.wasPressed = false;
                    this.set('pressed', this.oldPressed);
                }
            },

        });
    </script>
</dom-module>
